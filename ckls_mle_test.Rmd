---
title: "CKLS 1D - Sim.DiffProc"
author: "R. Dance"
output:
  html_notebook:
    toc: yes
  pdf_document:
    toc: yes
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

This chunk is the CKLS SDE with some initial conditions in it! 
[Link to Source](https://cran.r-project.org/web/packages/Sim.DiffProc/vignettes/fitsde.html)

SET UP AS AN OU for a match to my Excel doc... the original parameters from the website are commented out next to the variables for the OU. 

CKLS:

$dX_t = (\theta_1 +\theta_2X_t)dt + \theta_3X_t^{\theta_4}dW_t$ 

where $X_0=0.2$, and $\theta_1=a0 = 0.01$, $\theta_2 = b0 = -0.1$, $\theta_3 = s0 = 0.1$ and $\theta_4 = g0 = 0$. 
```{r}
library(Sim.DiffProc)
set.seed(12345, kind="L'Ecuyer-CMRG")
a0 <- 0.01 #1
b0 <- -0.1 #2 #was -0.01
s0 <- 0.1 #0.5
g0 <- 0 #0.3
# I think this is simulated data
f <- expression( (a0 + b0*x) )
g <- expression(s0 * x^g0)
sim <- snssde1d(drift=f, diffusion=g, x0=0.1, N=10^3, Dt=10^-3)
mydata <- sim$X
# This is the model
fx <- expression( theta[1]+theta[2]*x ) ## drift coefficient of model
gx <- expression( theta[3]*x^theta[4] ) ## diffusion coefficient of model

fitmod <- fitsde(data = mydata, drift = fx, diffusion = gx, start = list(theta1=0.05, theta2=0.05, theta3=0.05,theta4=0),pmle="euler")
plot(sim)
```
```{r}
coef(fitmod) 
```
```{r}
summary(fitmod) 
```
So this gives a log likelihood (divide this by -2), which is a half decent match to the Excel, HOWEVER, the parameters are wildly off!?! Look at the theta1 and theta2, they are way out, but the standard errors are also huge?? 

vcov produces the variance-covariance matrix for the parameters... 

```{r}
vcov(fitmod)
```
Log Likelihood....
```{r}
logLik(fitmod)
```
Not too shabby as I got 4300 in Excel, but why are the parameters so bad?! 

I dont know what AIC (Akaike information criterion) or BIC (Bayesian information criterion) are in practice... 
```{r}
AIC(fitmod)
```
```{r}
BIC(fitmod)
```
Confidence Intervals... expecting this to be hilariously bad considering theta1 and theta2 above... 
```{r echo=TRUE}
confint(fitmod,level=0.95)
```
Again, the theta3, which is my sigma, is fine. The theta2 isn't so bad here - its comparing -0.1 to 0.7 which although bad isn't as bad as theta1, which is wildly out. ANY IDEAS?! 

_
